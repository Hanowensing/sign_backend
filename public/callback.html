<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Google ë¡œê·¸ì¸ ì²˜ë¦¬</title>
</head>
<body>
    <script>
        function getAuthCode() {
            const params = new URLSearchParams(window.location.search);
            return params.get('code'); // ğŸ”¥ Authorization Code ê°€ì ¸ì˜¤ê¸°
        }

        async function sendAuthCodeToBackend(authCode) {
            try {
                const response = await fetch('http://localhost:3000/auth/google', { // ğŸ”¥ ë°±ì—”ë“œë¡œ Authorization Code ì „ë‹¬
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ code: authCode })
                });

                const data = await response.json();
                console.log('Google Access Token:', data.access_token);

                if (data.access_token) {
                    fetchUserInfo(data.access_token);
                } else {
                    console.error('í† í° ìš”ì²­ ì‹¤íŒ¨:', data);
                    window.location.href = 'index.html'; // ë¡œê·¸ì¸ í˜ì´ì§€ë¡œ ëŒì•„ê°€ê¸°
                }

            } catch (error) {
                console.error('ë°±ì—”ë“œ ìš”ì²­ ì˜¤ë¥˜:', error);
            }
        }

        async function fetchUserInfo(accessToken) {
            console.log("ğŸ“¥ Google API ìš”ì²­: Access Token ì‚¬ìš©", accessToken);

            const response = await fetch('https://www.googleapis.com/oauth2/v2/userinfo', {
                headers: { Authorization: `Bearer ${accessToken}` }
            });

            const userInfo = await response.json();
            console.log('Google ì‚¬ìš©ì ì •ë³´:', userInfo);

            // âœ… ë¡œì»¬ ìŠ¤í† ë¦¬ì§€ì— ì €ì¥
            localStorage.setItem('googleUser', JSON.stringify(userInfo));
            localStorage.setItem("access_token",accessToken);
            // âœ… ë©”ì¸ í˜ì´ì§€ë¡œ ì´ë™
            window.location.href = 'mainpage.html';
        }

        const authCode = getAuthCode();
        if (authCode) {
            sendAuthCodeToBackend(authCode); // ğŸ”¥ ë°±ì—”ë“œë¡œ Authorization Code ì „ì†¡
        } else {
            console.error('Authorization Code ì—†ìŒ');
            window.location.href = 'index.html'; // ì‹¤íŒ¨ ì‹œ ë¡œê·¸ì¸ í˜ì´ì§€ë¡œ ì´ë™
        }
    </script>
</body>
</html>
